#! /usr/bin/env python
# encoding: utf-8

def options(opt):
	pass

def configure(conf):
	if not conf.path.find_dir('speex'):
		conf.fatal('Can\'t find speex submodule. Run `git submodule update --init --recursive`.')
		return

	# Check for required features
	conf.check_cc(fragment='''#include <math.h>
int main(void) { return (int)floor(1.5); }''', msg='Checking for math library', mandatory=True)

def build(bld):
	sources = bld.path.ant_glob([
		'speex/libspeex/*.c'
	], excl = [
		'speex/libspeex/testenc.c',
		'speex/libspeex/testenc_wb.c',
		'speex/libspeex/testenc_uwb.c'
	])
	
	includes = ['speex/include/', 'speex/libspeex/']
	defines = ['FLOATING_POINT', 'EXPORT=', 'USE_KISS_FFT']

	# libspeex is C-only library, so force C features
	bld.stlib(
		source = sources,
		target = 'speex',
		features = 'c',
		includes = includes,
		defines = defines,
		export_includes = ['speex/include/'],
		use = ['m']
	)